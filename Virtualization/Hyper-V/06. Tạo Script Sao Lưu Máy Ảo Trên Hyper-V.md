# Hướng Dẫn Tạo Script Sao Lưu Máy Ảo Trên Hyper-V Với Đường Dẫn Cụ Thể

## Giới Thiệu
Bài viết này hướng dẫn cách tạo PowerShell script sao lưu một máy ảo trên Hyper-V bằng cách chỉ định tên máy ảo và đường dẫn sao lưu cụ thể. Script này giúp tự động hóa quá trình sao lưu máy ảo và lưu kết quả vào một thư mục với dấu thời gian.

## Yêu Cầu
- Hyper-V đã được cài đặt và chạy trên máy chủ.
- PowerShell phiên bản 5.1 trở lên.
- Đường dẫn lưu trữ backup có dung lượng đủ lớn để chứa các bản sao lưu.

## Cấu Trúc Script

    ```shell
    # Định nghĩa tên máy ảo và đường dẫn sao lưu
    $vmName = "Windows Server"
    $timestamp = Get-Date -Format 'yyyyMMdd-HHmmss'
    $backupPath = "C:\Backup-VM\$vmName-$timestamp"

    # Tạo thư mục sao lưu nếu chưa có
    New-Item -Path $backupPath -ItemType Directory -Force | Out-Null
  
    # Bắt đầu sao lưu máy ảo
    Write-Output "Get Export VM $vmName..."
    Export-VM -Name $vmName -Path $backupPath

    # Kiểm tra kích thước của thư mục sao lưu
    $backupSize = (Get-ChildItem -Path $backupPath -Recurse | Measure-Object -Property Length -Sum).Sum
    Write-Output "Thư mục sao lưu đã được tạo tại: $backupPath (Size: $($backupSize / 1MB) MB)"
    ```
viết hướng dẫn các bước chi tiết theo như này
Lưu script này vào một file .ps1 (ví dụ: Backup_WindowsServer.ps1).

![image](https://github.com/user-attachments/assets/16a6fe4b-3974-48a4-abad-ac80215b4e0c)

![image](https://github.com/user-attachments/assets/943039e0-859e-4e0e-8387-d2ac215e927b)

## Bước 5: Thiết Lập Lịch Sao Lưu (Tùy Chọn)
Sử dụng Task Scheduler trên Windows để tự động chạy script theo lịch, ví dụ hàng ngày vào lúc 12 giờ đêm.

Mở Task Scheduler,  Chọn Create Task.

![image](https://github.com/user-attachments/assets/3cba84dd-975d-42a7-8002-9d449f50c5c4)

Đặt tên cho task, ví dụ: Backup VM Hyper-V.
Ở tab Triggers, chọn New để thiết lập thời gian chạy (ví dụ: hàng sáng vào 6h00).

![image](https://github.com/user-attachments/assets/d2df5ce0-c0f4-42cd-be17-84f8a7137ef0)

Ở tab Actions, chọn Start a Program và trỏ đến file script Backup_WindowsServer.ps1.

![image](https://github.com/user-attachments/assets/201a9c50-8780-4bef-aa22-aa33f386fa80)

![image](https://github.com/user-attachments/assets/54e3c015-1fef-45ef-be1d-32b5fa929e88)

Nhấn OK để lưu lại.

![Command Prompt](https://github.com/cuongnvvietis/NhanHoa/blob/main/Docs/Picture/Hyper-v/Screenshot_39.png)

## Bước 6: Khi restore thì thiết lập lại quyền ở thư mục để Hyper-v có quyền đọc ghi và copy về lại thư mục cần restore

![image](https://github.com/user-attachments/assets/be5edf40-0ba2-4dc7-8f84-27d83a26ee89)

![Command Prompt](https://github.com/cuongnvvietis/NhanHoa/blob/main/Docs/Picture/Hyper-v/Screenshot_41.png)
